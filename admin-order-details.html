<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Order | Sir's 'n' Suits</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .mobile-menu-btn { display: none; position: fixed; top: 15px; left: 15px; z-index: 1000; background: var(--brand-black); color: var(--brand-gold); border: 1px solid var(--brand-gold); border-radius: 4px; padding: 10px; font-size: 1.2em; cursor: pointer; }
        @media (max-width: 768px) {
            .mobile-menu-btn { display: block; }
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; position: fixed; z-index: 999; height: 100%; width: 260px; }
            .sidebar.active { transform: translateX(0); }
            .main-content { padding: 20px; padding-top: 60px; }
        }
    </style>
</head>
<body>
    
    <div class="dashboard-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <h1 class="sidebar-logo">Sir<span class="sidebar-n">'s</span> <span class="sidebar-n">'n'</span> Suits</h1>
                    <span class="sidebar-subtitle">BY GEORGE</span>
                </div>
            </div>
            <p id="user-info">Logged in as: Owner</p>
            <nav>
                <a href="admin-dashboard.html">üëë Admin Dashboard</a>
                <a href="admin-current-orders.html">üåç Global Active Orders</a>
                <a href="admin-all-orders.html">üìÇ Global Order History</a>
                <a href="financial-overview.html">üìà Financial Overview</a>
                <a href="admin-management.html">‚öôÔ∏è Management & Setup</a>
                <a href="#" id="logout-btn">‚û°Ô∏è Logout</a>
            </nav>
        </aside>

        <main class="main-content">
            <header>
                <a href="javascript:history.back()" style="text-decoration:none; color:#007bff;">&larr; Back</a>
                <h1 id="admin-detail-header">Order Details (Admin Edit)</h1>
            </header>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                
                <div class="container" style="margin:0;">
                    <h2>üìù Edit Order Data</h2>
                    <form onsubmit="event.preventDefault(); saveAdminOrder();">
                        <fieldset>
                            <legend>Customer Info</legend>
                            <label>Name</label><input type="text" id="edit-customer-name">
                            <label>Phone</label><input type="text" id="edit-customer-phone">
                        </fieldset>
                        
                        <fieldset>
                            <legend>Garment & Status</legend>
                            <label>Type</label>
                            <select id="edit-garment-type">
                                <option value="Suit">Suit</option>
                                <option value="Kaunda/Senator Suit">Kaunda/Senator Suit</option>
                                <option value="Trouser">Trouser</option>
                                <option value="Dress">Dress</option>
                                <option value="Shirt">Shirt</option>
                                <option value="Coat">Coat</option>
                                <option value="Half Coat">Half Coat</option>
                                <option value="Alteration">Alteration</option>
                            </select>
                            <label>Due Date</label><input type="date" id="edit-due-date">
                            <label>Status</label>
                            <select id="edit-status">
                                <option value="1">1. Assigned</option>
                                <option value="2">2. In Progress</option>
                                <option value="3">3. QA Check</option>
                                <option value="4">4. Ready</option>
                                <option value="5">5. Collected</option>
                                <option value="6">6. Closed</option>
                            </select>
                        </fieldset>

                        <fieldset>
                            <legend>Assignment</legend>
                            <label>Team Lead</label>
                            <select id="edit-worker-select"><option value="">Select Worker</option></select>
                            <label style="font-weight: bold; color: #666; font-size: 0.9em; display:block; margin-top:10px; margin-bottom:5px;">üë• Support Squad</label>
                            <div id="squad-selection-container" style="max-height: 150px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #fafafa; border-radius: 4px;">
                                <p style="font-size: 0.8em; color: #999; text-align: center; margin: 0;">Loading team...</p>
                            </div>
                        </fieldset>

                        <fieldset>
                            <legend>Financials</legend>
                            <label>Total Price (Ksh)</label><input type="number" id="edit-price" step="0.01">
                        </fieldset>

                        <fieldset>
                            <legend>Measurements</legend>
                            <div id="admin-measurement-fields-container"></div>
                            <textarea id="edit-preferences" rows="3" placeholder="Notes..."></textarea>
                        </fieldset>

                        <button type="submit" style="background-color: var(--brand-gold); color: black; margin-top: 15px;">üíæ Save Changes</button>
                    </form>
                    <button onclick="deleteOrder()" style="background-color: #000; color: #dc3545; border: 1px solid #dc3545; margin-top: 20px; width: 100%;">‚ò†Ô∏è DELETE ORDER</button>
                </div>

                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="container" style="margin:0;">
                        <h2>üìä Live Summary</h2>
                        <div style="background:#f8f9fa; padding:15px; border-radius:4px; margin-bottom:10px;">
                            <p><strong>Shop:</strong> <span id="admin-detail-shop">Loading...</span></p>
                            <p><strong>Customer:</strong> <span id="summary-customer-name">...</span></p>
                            <p><strong>Phone:</strong> <a id="summary-customer-phone" href="#">...</a></p>
                            <p><strong>Item:</strong> <span id="summary-garment-type">...</span></p>
                            <p><strong>Due:</strong> <span id="summary-due-date">...</span></p>
                            <p><strong>Status:</strong> <span id="summary-status">...</span></p>
                        </div>

                        <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
                            <h3 style="margin: 0 0 10px 0; font-size: 1em; color: #555;">Production Details</h3>
                            <p style="margin-bottom: 8px;"><strong>üë∑ Assigned Team:</strong><br> <span id="summary-worker-display" style="color: #007bff;">Loading...</span></p>
                            <p style="margin-bottom: 8px;"><strong>üìù Customer Notes:</strong><br> <span id="summary-notes" style="font-style: italic; color: #666;">-</span></p>
                            <div style="background: #fff; border: 1px solid #eee; padding: 10px; border-radius: 4px; font-size: 0.85em; color: #444;">
                                <strong style="display:block; margin-bottom:5px; border-bottom:1px solid #eee; padding-bottom:3px;">üìè Measurements</strong>
                                <span id="summary-measurements">No data</span>
                            </div>
                        </div>

                        <div id="balance-box" class="stat-box box-black" style="margin-top: 15px;">
                            <small>Financial Status</small>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.9em;">
                                <span>Total:</span> <span id="display-total-price">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.9em;">
                                <span>Paid:</span> <span id="display-total-paid" style="color: var(--profit-green);">0</span>
                            </div>
                            <div style="border-top: 1px solid rgba(255,255,255,0.2); margin-top: 5px; padding-top: 5px; display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1em;">
                                <span>Balance:</span> <span id="display-balance-due">0</span>
                            </div>
                        </div>

                        <h3 style="margin-top: 20px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Payment History</h3>
                        <div style="max-height: 200px; overflow-y: auto;">
                            <table style="font-size: 0.85em;">
                                <thead><tr><th>Date</th><th>Amt</th><th>By</th><th>Note</th></tr></thead>
                                <tbody id="payment-history-tbody"><tr><td colspan="4">Loading...</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="config.js"></script>
    <script src="app.js"></script>
    <script src="mobile-nav.js"></script>
</body>
</html>